---
title: "H Test"
author: "Joshua Taylor Milliken"
date: "2023-11-18"
output: word_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
library(AER)
library(ivreg)
library(jtools)
library(stargazer)
dat <- read.csv('tansferdata.csv')
dat2 <- read.csv('huuu.csv')
```

## Including Plots

You can also embed plots, for example:

```{r pressure}
model <- lm(lnGDPPC ~ lnGDPPCm5 + IVlnGGm5 + IVGinim5 + OPS + TWWIavg + dpTWWIavg + n + factor(Country) + factor(Year), data = dat)

# Print summary of the regression
stargazer(summary(model))
```

```{r square}
model <- lm(lnGDPPC ~ lnGDPPCm5 + IVlnGGm5 + IVlnGG2m5  + IVGinim5 + IVGini2m5  + OPS + TWWIavg + n + IVlnGG3m5 + IVGini3m5 +  factor(Country) + factor(Year), data = dat) #+ IVlnGG3m5 + IVGini3m5

modelNOIV <- lm(lnGDPPC ~ lnGDPPCm5 + lnGGm5 + lnGG2m5  + Ginim5 + Gini2m5  + OPS + TWWIavg + dpTWWIavg + n + factor(Country) + factor(Year), data = dat) #+ IVlnGG3m5 + IVGini3m5

model2 <- lm(lnGDPPC ~ lnGDPPCm5 + IVlnGGm5 + IVlnGG2m5  + IVGinim5 + IVGini2m5  + OPS + TWWIavg + dpTWWIavg + n + factor(Country) + factor(Year), data = dat) #+ IVlnGG3m5 + IVGini3m5

model2 <- lm(lnGDPPC ~ lnGDPPCm5 + IVlnGGm5 + IVlnGG2m5  + IVGinim5 + IVGini2m5  + OPS + TWWIavg + dpTWWIavg + n + FDIavg + factor(Country) + factor(Year), data = dat) #+ IVlnGG3m5 + IVGini3m5

model2 <- lm(lnGDPPC ~ lnGDPPCm5 + IVlnGGm5 + IVlnGG2m5  + IVGinim5 + IVGini2m5  + OPS + TWWIavg + dpTWWIavg + n + FDIavg + GFDIavg + G2FDIavg + factor(Country) + factor(Year), data = dat) #+ IVlnGG3m5 + IVGini3m5

#############

model4 <- lm(lnGDPPC ~ lnGDPPCm5 + IVlnGGm5 + IVlnGG2m5  + IVGinim5 + IVGini2m5  + OPS + TWWIavg + dpTWWIavg + n + abs_red + factor(Country) + factor(Year), data = dat) #+ IVlnGG3m5 + IVGini3m5

model5 <- lm(lnGDPPC ~ lnGDPPCm5 + IVlnGGm5 + IVlnGG2m5  + IVGinim5 + IVGini2m5  + OPS + TWWIavg + dpTWWIavg + n + IVlnGG3m5 + IVGini3m5 + factor(Country) + factor(Year), data = dat) #+ IVlnGG3m5 + IVGini3m5

model6 <- lm(lnGDPPC ~ lnGDPPCm5 + IVlnGGm5 + IVlnGG2m5  + IVGinim5 + IVGini2m5  + OPS + TWWIavg + dpTWWIavg + n + RellnGDPPCm5 + IVRellnGGm5 + IVRellnGG2m5 + factor(Country) + factor(Year), data = dat) #+ IVlnGG3m5 + IVGini3m5

model7 <- lm(lnGDPPC ~ lnGDPPCm5 + IVGinim5 + IVGini2m5  + OPS + TWWIavg + dpTWWIavg + n + RellnGDPPCm5 + IVRellnGGm5 + IVRellnGG2m5 + factor(Country) + factor(Year), data = dat) #+ IVlnGG3m5 + IVGini3m5

model8 <- lm(lnGDPPC ~ lnGDPPCm5 + IVGinim5 + IVGini2m5  + OPS + TWWIavg + dpTWWIavg + n + RelGDPPCm5 + IVRelGGm5 + IVRelGG2m5 + factor(Country) + factor(Year), data = dat) #+ IVlnGG3m5 + IVGini3m5

# model3 <- lm(lnGDPPC ~ lnGDPPCm5 + IVlnGGm5 + IVlnGG2m5  + IVGinim5 + IVGini2m5  + OPS + TWWIavg + n + IVlnG2Gm5 + IVlnG2G2m5 + IVlnG2G3m5 + lnGDPPC2m5 + factor(Country) + factor(Year), data = dat) #+ IVlnGG3m5 + IVGini3m5

anova(model, model2)

# Print summary of the regression
summary(modelNOIV)
stargazer(modelNOIV, type = "text")
library(broom)
tidy(modelNOIV)

g <- .2
d <- 10.604420
new <- data.frame(Year = c(2010),Country = c("Canada"), lnGDPPCm5 = c(d), IVlnGGm5 = c(g*d), IVlnGG2m5 = c(g**2 * d), IVGinim5 = c(g), IVGini2m5 = c(g**2))
predict(model, newdata = new)

```

```{r IV}
#ivs <- lm(Gini ~ lnGDPPC + OPS + TWWI + dpTWWI + n + factor(Country) + factor(Year), data = dat)

ivs <- ivreg(lnGDPPC ~ lnGDPPCm5 + lnGGm5 + Ginim5 + OPS + TWWIavg + dpTWWIavg + n + factor(Country) + factor(Year) | OPS + TWWIavg + dpTWWIavg + n + factor(Country) + factor(Year), data = dat)

ivs <- ivreg(lnGDPPC ~ lnGDPPCm5 + Ginim5 + lnGGm5 + dpTWWIavg + n + factor(Country) + factor(Year)| OPS + TWWIavg + dpTWWIavg + n + factor(Country) + factor(Year), data = dat)

summary(ivs)
```
```{r Bootstrap SE}
summary_with_percentiles <- function(x) {
  summary_data <- summary(x)
  quantiles <- quantile(x, probs = c(0.001, 0.01, 0.05, 0.1, 0.90, 0.95, 0.99, 0.999))
  names(quantiles) <- c(".1%", "1%", "5%", "10%", "90%", "95%", "99%", "99.9%")
  c(summary_data, quantiles)
}

library(boot)
data = dat

bootnum = 1000

bootcoef <- vector(mode='list', length=bootnum)


# Step 1: First stage regression
for (i in 1:bootnum) {
  print(i)

#random sample with replacemnt
data <- dat[sample(nrow(dat), nrow(dat), replace=T), ]

first_stage <- lm(Gini ~ lnGDPPC + OPS + TWWI + n + factor(Country) + factor(Year) + factor(PR), data = data)
summary(first_stage)

IVGini <- predict(first_stage)

data$Gini <- IVGini
data$Gini2 <- data$Gini * data$Gini
data$lnGG <- data$Gini * data$lnGDPPC
data$lnGG2 <- data$Gini2 * data$lnGDPPC

# Step 2: Second stage regression
second_stage <- lm(lnGDPPCp5 ~ lnGDPPC + Gini + Gini2 + lnGG + lnGG2 + n + factor(PR) + factor(Country) + factor(Year), data = data)

bootcoef[i] <- list(summary(second_stage)$coefficients[1:7])

} # end for loop

data <- dat

first_stage <- lm(Gini ~ lnGDPPC + OPS + TWWI + n + factor(Country) + factor(Year) + factor(PR), data = data)
summary(first_stage)

IVGini <- predict(first_stage)

data$Gini <- IVGini
data$Gini2 <- data$Gini * data$Gini
data$lnGG <- data$Gini * data$lnGDPPC
data$lnGG2 <- data$Gini2 * data$lnGDPPC

# Step 2: Second stage regression
second_stage <- lm(lnGDPPCp5 ~ lnGDPPC + Gini + Gini2 + lnGG + lnGG2 + n + factor(PR) + factor(Country) + factor(Year), data = data)

summary(second_stage)#$coefficients[1:7]

bootcoef

bootcoefM <- matrix(unlist(bootcoef), nrow = length(bootcoef), byrow = TRUE)
#for (i in 1:7) { 
  summary_with_percentiles( summary(bootcoefM[ ,6]) ) 
#}


# Transpose the matrix
#transposed_matrix <- t(bootcoefM)

```


```{r FD}
md <- lm(d5pGDPPC ~ IVGinim5 + IVGini2m5  + OPS + TWWIavg + dpTWWIavg + n + FDavg + IVGFDavg + IVG2FDavg + factor(Country) + factor(Year), data = dat)
summary(md)
```

```{r square}
model <- lm(lnHDI ~ lnHDIm5 + GHDIm5 + GHDI2m5 + Ginim5 + Gini2m5 + factor(Country) + factor(Year), data = dat2)

# Print summary of the regression
summary(model)
```


```{r idk}
load("swiid9_5/swiid9_5.rda")
```

6.797023  = .2 = 10.52867
6.798331 = .5 = 10.7941
6.799638 = .8 = 11.05953 
